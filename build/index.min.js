var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},fivefold;!function(a){function b(a,b){var c=p;if("string"==typeof b){var d=b.split(q);c.registerRoute(new m(a,d[0],d[1]))}}var c=function(){function a(){this.prefix="",this.suffix=""}return a.prototype.realizeTry=function(a){var b=this;return monapt.Try(function(){return b.realize(a)})},a.prototype.realize=function(a){var b=this.getClass(this.parsePathOrName(a));return new b},a.prototype.parsePathOrName=function(b){return b.split(a.pathSplitter)},a.prototype.getClass=function(a){for(var b,c=window,d=0,e=a.length;e>d;d++)b=a[d],c=c[d==e-1?this.prefix+b+this.suffix:b];return c},a.pathSplitter=/\./,a}();a.Realizer=c;var d=function(a){function b(){a.apply(this,arguments),this.suffix="Controller"}return __extends(b,a),b}(c);a.ControllerRealizer=d;var e=function(){function a(){}return a.prototype.params=function(){return{}},a.prototype.onBefore=function(){},a.prototype.execute=function(){},a.prototype.onAfter=function(){},a.prototype.executeScenario=function(a){var b=this;this.onBefore(a),this.execute(a,this.params(a),function(){b.onAfter(a)},function(){b.onAfter(a)})},a}();a.Scenario=e;var f=function(){function a(){var a=this;this.$el=null,this.tagName="div",this.id="",this.className="",this.attributes={},this.ensureFuture=monapt.future(function(b){setTimeout(function(){try{a.ensureElement(),a.delegateEvents(),a.created(a.$el),b.success(a)}catch(c){b.failure(c)}},0)})}return a.prototype.ensureElement=function(){if(!this.$el){var a={};for(var b in this.attributes)a[b]=this.attributes[b];a.id=this.id,a["class"]=this.className,this.$el=$("<"+this.tagName+">").attr(a)}},a.prototype.delegateEvents=function(){var b=this,c=new monapt.Map(this.events);c.mapValues(function(a){return b[a]}).filter(function(a){return $.isFunction(a)}).map(function(b,c){var d=b.match(a.eventSplitter);return monapt.Tuple2(d[1],monapt.Tuple2(d[2],c))}).foreach($.proxy(this.delegate,this))},a.prototype.delegateScenarios=function(){var b=this,c=new monapt.Map(this.scenarios);c.mapValues(function(a){return function(){a.executeScenario(b)}}).map(function(b,c){var d=b.match(a.eventSplitter);return monapt.Tuple2(d[1],monapt.Tuple2(d[2],c))}).foreach($.proxy(this.delegate,this))},a.prototype.delegate=function(a,b){var c=b._1,d=b._2;c&&""!==c?this.$el.on(a+".fivefold",d):this.$el.on(a+".fivefold",c,d)},a.prototype.renderFuture=function(){var a=this;return this.ensureFuture.map(function(b,c){setTimeout(function(){try{a.render(),c.success(a)}catch(b){c.failure(b)}},0)})},a.prototype.render=function(){},a.prototype.created=function(){},a.eventSplitter=/^(\S+)\s*(.*)$/,a}();a.View=f;var g=function(a){function b(){a.apply(this,arguments),this.$el=$(document.body),this.$content=$(document.body)}return __extends(b,a),b.prototype.beforeDisplayContent=function(){},b.prototype.renderFuture=function(){return a.prototype.renderFuture.call(this)},b.prototype.display=function(a){this.$content.html(a)},b}(f);a.Layout=g;var h=new g,i=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(monapt.Future);a.ActionFuture=i,a.actionFuture=function(a){return monapt.future(function(b){return a(b)})};var j=function(){function a(){this.layout=h}return a.prototype.dispatchFuture=function(a,b){var c=this.layout.renderFuture(),d=this[a](b);return d.flatMap(function(a){return c.map(function(b,c){setTimeout(function(){var d=a.renderFuture();d.onSuccess(function(a){b.beforeDisplayContent(),b.display(a.$el),c.success(a)}),d.onFailure(function(a){return c.failure(a)})})})})},a}();a.Controller=j;var k=function(){function a(){}return a.prototype.controllerForRoute=function(a){var b=new d;return b.realizeTry(a.controller).map(function(a){return new monapt.Some(a)}).getOrElse(function(){return new monapt.None})},a}(),l=new k,m=function(){function a(a,b,c){this.pattern=a,this.controller=b,this.method=c}return a}();a.Route=m;var n=function(){function a(){}return a.prototype.resolve=function(a,b){var c=this,d=this.parse(a);return b.find(function(a){return c.match(d.pattern,a)}).map(function(a){return monapt.Tuple2(a._2,d.options)})},a.prototype.parse=function(){return{options:{},pattern:null}},a.prototype.match=function(){return!1},a}();a.RouteResolver=n;var o=function(){function a(){this.routes={}}return a.prototype.routesMap=function(){return new monapt.Map(this.routes)},a.prototype.registerRoute=function(a){this.routes[a.pattern]=a},a}();a.RouteRepository=o;var p=new o,q=/::/,r=function(){function a(a){this.resolver=a,this.dispatcher=new s,this.start()}return a.prototype.start=function(){var a=this;window.onhashchange=function(){a.onHashChange()},setTimeout(function(){return a.onHashChange()},0)},a.prototype.onHashChange=function(){var a=this,b=location.hash;this.resolver.resolve(b,p.routesMap()).match({Some:function(b){return a.dispatcher.dispatch(b._1,b._2)},None:function(){return console.error("No route...")}})},a.prototype.routes=function(a){a(b)},a}();a.Router=r;var s=function(){function a(){}return a.prototype.dispatch=function(a,b){l.controllerForRoute(a).match({Some:function(c){return c.dispatchFuture(a.method,b)},None:function(){return console.error("Dispatch failure.")}})},a}();a.Dispatcher=s}(fivefold||(fivefold={}));