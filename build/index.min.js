var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},fivefold;!function(a){function b(a,b){var c=l.ofMemory();if("string"==typeof b){var d=b.split(m);c.registerRoute(new k(a,d[0],d[1]))}}var c=function(){function a(){this.prefix="",this.suffix=""}return a.prototype.realizeTry=function(a){var b=this;return monapt.Try(function(){return b.realize(a)})},a.prototype.realize=function(a){var b=this.getClass(this.parsePathOrName(a));return new b},a.prototype.parsePathOrName=function(b){return b.split(a.pathSplitter)},a.prototype.getClass=function(a){for(var b,c=window,d=0,e=a.length;e>d;d++)b=a[d],c=c[d==e-1?this.prefix+b+this.suffix:b];return c},a.pathSplitter=/\./,a}();a.Realizer=c;var d=function(a){function b(){a.apply(this,arguments),this.suffix="Controller"}return __extends(b,a),b}(c);a.ControllerRealizer=d;var e=function(){function a(){this.$el=null,this.tagName="div",this.id="",this.className="",this.attributes={},this.template=null,this.ensureElement()}return a.prototype.ensureElement=function(){if(!this.$el){var a={};for(var b in this.attributes)a[b]=this.attributes[b];a.id=this.id,a["class"]=this.className,this.$el=$("<"+this.tagName+">").attr(a)}},a.prototype.render=function(){this.template&&this.$el.html(this.template.render(this.values()))},a.prototype.values=function(){return{}},a}();a.View=e;var f=function(a){function b(){a.apply(this,arguments),this.$el=$(document.body),this.$content=$(document.body)}return __extends(b,a),b.prototype.beforeDisplayContent=function(){},b}(e);a.Layout=f;var g=new f,h=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(monapt.Future);a.ActionFuture=h,a.actionFuture=function(a){return monapt.future(function(b){return a(b)})};var i=function(){function a(){this.layout=g}return a.prototype.dispatch=function(a,b){var c=this;this.layout.render();var d=this[a](b);d.onComplete(function(a){a.match({Success:function(a){a.render(),c.layout.beforeDisplayContent(),c.layout.$content.html(a.$el)},Failure:function(){console.log("error")}})})},a}();a.Controller=i;var j=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(i);a.FinalErrorController=j;var k=function(){function a(a,b,c){this.pattern=a,this.controller=b,this.method=c}return a}();a.Route=k;var l=function(){function a(){this.routes={}}return a.ofMemory=function(){return a.sharedInstance},a.prototype.routeForRelativeURL=function(a){var b=this;return this.validate(),this.parser(a).flatMap(function(a){return new monapt.Map(b.routes).get(a._1)})},a.prototype.routeForKey=function(){return this.validate(),null},a.prototype.validate=function(){if(!this.parser)throw new Error("No such parser")},a.prototype.registerRoute=function(a){this.routes[a.pattern]=a},a.sharedInstance=new a,a}();a.RouteRepository=l;var m=/::/,n=function(){function a(a){this.parser=a,this.routeRepository=l.ofMemory(),this.dispatcher=new o,this.routeRepository.parser=a,this.start()}return a.prototype.start=function(){var a=this;window.onhashchange=function(){a.onHashChange()},setTimeout(function(){return a.onHashChange()},0)},a.prototype.onHashChange=function(){var a=this,b=location.hash;this.routeRepository.routeForRelativeURL(b).match({Some:function(c){var d=a.parser(b).getOrElse(function(){return monapt.Tuple2(null,null)})._2;a.dispatcher.dispatch(c,d)},None:function(){}})},a.prototype.routes=function(a){a(b)},a}();a.Router=n;var o=function(){function a(){this.realizer=new d}return a.prototype.dispatch=function(a,b){var c=this;this.realizer.realizeTry(a.controller).orElse(function(){return c.dispatchErrorTry()}).getOrElse(function(){return new j}).dispatch(a.method,b)},a.prototype.dispatchErrorTry=function(){var a=this;return monapt.Try(function(){return l.ofMemory().routeForRelativeURL("dispatchFailure").map(function(a){return a.controller}).get()}).flatMap(function(b){return a.realizer.realizeTry(b)})},a}();a.Dispatcher=o}(fivefold||(fivefold={}));