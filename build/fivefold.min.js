var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},fivefold;!function(a){function b(a){return"function"==typeof a&&!(a instanceof RegExp)}function c(a,c){for(var d=[],e=0;e<arguments.length-2;e++)d[e]=arguments[e+2];return b(a)?function(){return a.apply(c||this,d)}:void 0}function d(){return"view"+m++}function e(a){if(!a.$el){var b={};for(var c in a.attributes)b[c]=a.attributes[c];a.id&&(b.id=a.id),a.className&&(b["class"]=a.className),a.$el=$("<"+a.tagName+">").attr(b)}}function f(a,b){var c=y;if("string"==typeof b){var d=b.split(B);c.registerRoute(new w(a,d[0],d[1]))}}function g(a,b){var c=A,d=b.split(B),e=null;e="number"==typeof a?new w("fivefold"+a,d[0],d[1]):new w(a,d[0],d[1]),c.registerRoute(e)}var h=/\./,i=function(){function a(){this.prefix="",this.suffix=""}return a.prototype.realizeTry=function(a){var b=this;return monapt.Try(function(){return b.realize(a)})},a.prototype.realize=function(a){var b=this.getClass(this.parsePathOrName(a));return new b},a.prototype.parsePathOrName=function(a){return a.split(h)},a.prototype.getClass=function(a){for(var b,c=window,d=0,e=a.length;e>d;d++)b=a[d],c=c[d==e-1?this.prefix+b+this.suffix:b];return c},a}();a.Realizer=i,function(a){a[a.NotFound=-1]="NotFound",a[a.DispatchFailure=-2]="DispatchFailure"}(a.RouteError||(a.RouteError={}));var j=a.RouteError,k=function(){return new Error("fivefold"+j.NotFound)},l=function(){function a(){}return a.prototype.params=function(){return{}},a.prototype.onBefore=function(){},a.prototype.execute=function(){},a.prototype.onAfter=function(){},a.prototype.executeScenario=function(a){var b=this;this.onBefore(a),this.execute(a,this.params(a),function(){b.onAfter(a)},function(){b.onAfter(a)})},a}();a.Scenario=l;var m=0,n=/^(\S+)\s*(.*)$/,o=function(){function a(){this.cid=d(),this.$el=null,this.tagName="div",this.id="",this.className="",this.attributes={}}return a.create=function(){var a=new this;return e(a),a.delegateEvents(),a.delegateScenarios(),a},a.prototype.delegateEvents=function(){var a=this,d=new monapt.Map(this.events);return d.mapValues(function(b){return a[b]}).filter(function(a,c){return b(c)}).map(function(b,d){var e=b.match(n);return monapt.Tuple2(e[1],monapt.Tuple2(e[2],c(d,a)))}).foreach(function(b,c){return a.delegate(b,c._1,c._2)}),this},a.prototype.delegateScenarios=function(){var a=this,b=new monapt.Map(this.scenarios);return b.mapValues(function(b){return function(){b.executeScenario(a)}}).map(function(a,b){var c=a.match(n);return monapt.Tuple2(c[1],monapt.Tuple2(c[2],b))}).foreach(function(b,c){return a.delegate(b,c._1,c._2)}),this},a.prototype.delegate=function(a,b,c){var d=a+".ff"+this.cid;this.$el.on.call(this.$el,d,b,c)},a.prototype.undelegateAll=function(){this.$el.off(".ff"+this.cid)},a.prototype.render=function(){return this},a}();a.View=o;var p=function(a){function b(){a.apply(this,arguments),this.$el=$(document.body),this.$content=$(document.body)}return __extends(b,a),b.create=function(){var a=new this;return e(a),a.delegateEvents(),a.delegateScenarios(),a},b.prototype.beforeDisplayContent=function(){},b.prototype.display=function(a){this.$content.html(a)},b}(o);a.Layout=p;var q=new p,r=function(){function a(){this.layout=q}return a.prototype.dispatch=function(a,b){var c=this;this.layout.render();var d=this[a](b);d.onSuccess(function(a){a.render(),c.layout.beforeDisplayContent(),c.layout.display(a.$el)}),d.onFailure(function(a){return console.log(a)})},a}();a.Controller=r;var s=function(){function a(){}return a.prototype.controllerForRouteTry=function(a){var b=new u;return b.realizeTry(a.controller).filter(function(a){return a instanceof r})},a}(),t=new s,u=function(a){function b(){a.apply(this,arguments),this.suffix="Controller"}return __extends(b,a),b}(i);a.ControllerRealizer=u;var v=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(monapt.Future);a.ActionFuture=v,a.actionFuture=function(a){return monapt.future(function(b){return a(b)})};var w=function(){function a(a,b,c){this.pattern=a,this.controller=b,this.method=c}return a}();a.Route=w;var x=function(){function a(){this.routes={}}return a.prototype.routesMap=function(){return new monapt.Map(this.routes)},a.prototype.registerRoute=function(a){this.routes[a.pattern]=a},a}(),y=new x,z=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.routeForError=function(b){return a.prototype.routesMap.call(this).get(b.message)},b}(x),A=new z,B=/::/,C=function(){function a(){}return a.prototype.resolve=function(a,b){var c=this,d=this.parse(a);return b.find(function(a){return c.match(d.pattern,a)}).map(function(a){return monapt.Tuple2(a._2,d.options)})},a.prototype.parse=function(){return{options:{},pattern:null}},a.prototype.match=function(){return!1},a}();a.RouteResolver=C;var D=function(){function a(a){this.resolver=a,this.dispatcher=new E,this.start()}return a.prototype.start=function(){var a=this;window.onhashchange=function(){a.onHashChange()},setTimeout(function(){return a.onHashChange()},0)},a.prototype.onHashChange=function(){var a=this,b=location.hash;this.resolver.resolve(b,y.routesMap()).match({Some:function(b){return a.dispatcher.dispatch(b._1,b._2)},None:function(){return a.dispatcher.dispatchError(k())}})},a.prototype.routes=function(a){a(f)},a.prototype.errorRoutes=function(a){a(g)},a}();a.Router=D;var E=function(){function a(){}return a.prototype.dispatch=function(a,b){var c=this;t.controllerForRouteTry(a).match({Success:function(c){return c.dispatch(a.method,b)},Failure:function(a){return c.dispatchError(a)}})},a.prototype.dispatchError=function(a){var b=this;A.routeForError(a).match({Some:function(a){b.dispatch(a,{})},None:function(){throw new Error("Route not found.")}})},a}();a.Dispatcher=E}(fivefold||(fivefold={}));